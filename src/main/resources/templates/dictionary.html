<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" >

<!-- head -->
<head th:replace="fragments/head :: head" />
<!-- /head -->

<!-- body -->
<body >

<!-- container -->
<div id="app" class="container" >

    <!-- header -->
    <div th:replace="fragments/header :: header" />
    <!-- /header -->

    <!-- search area -->
    <div >
        <form id="searchForm" >
            <div class="form-group" >
                <div class="row" >
                    <div class="col-1" ></div >
                    <div class="col-7" >
                        <span class="badge badge-danger text-wrap" style="width: 6rem;" >ÏòÅÏñ¥</span >
                        <input class="form-control" type="text" v-model="search.enWord"
                               placeholder="Í≤ÄÏÉâÌï† ÏòÅÏñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" @keyup.enter="findContents();" />
                    </div >
                    <div class="col-3" >
                        <button class="btn btn-outline-info" type="button" id="initialize" @click="resetSearchForm();" >Ï¥àÍ∏∞Ìôî</button >
                    </div >
                    <div class="col-1" ></div >
                </div >
                <br >
                <div class="row" >
                    <div class="col-1" ></div >
                    <div class="col-7" >
                        <span class="badge badge-info text-wrap" style="width: 6rem;" >ÌïúÍ∏Ä</span >
                        <input class="form-control" type="text" v-model="search.krWord"
                               placeholder="Í≤ÄÏÉâÌï† ÌïúÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî" @keyup.enter="findContents();" />
                    </div >
                    <div class="col-3" >
                        <button class="btn btn-outline-info" type="button" id="search" @click="findContents();" >Í≤ÄÏÉâ</button >
                    </div >
                    <div class="col-1" ></div >
                </div >
            </div >
        </form >
    </div >
    <!-- /search area -->

    <hr />

    <!-- total post & size area -->
    <div class="form-inline" >
        <h4 id="totalResultCount" >Ï†ÑÏ≤¥ Îã®Ïñ¥ : {{pager.totalElements}}Í∞ú</h4 >
        <span style="margin-left: auto;" >
                <select v-model="search.size" class="custom-select" @change="findContents();" >
                    <option value="10" >10Í∞ú</option >
                    <option value="30" >30Í∞ú</option >
                    <option value="50" >50Í∞ú</option >
                    <option value="100" >100Í∞ú</option >
                    <option value="200" >200Í∞ú</option >
                </select >
        </span >
    </div >
    <!-- /total post & size area -->

    <br />

    <!-- board area -->
    <div >
        <table class="table" id="table" >
            <thead >
            <tr class="text-center" >
                <th style="width:25%" >ÏòÅÏñ¥</th >
                <th style="width:25%" >ÌïúÍ∏Ä</th >
                <th style="width:25%" >ÏÇ¨ÏßÑ</th >
                <th style="width:25%" >Íµ¨Í∏Ä</th >
            </tr >
            </thead >

            <tbody id="posts" >
            <tr v-for="content in contents" >
                <td style="text-align:center; font-weight: bold; color: chocolate" >
                    {{content.enWord}}
                </td >
                <td style="text-align:center; font-weight: bold; color: navy" >
                    {{content.krWord}}
                </td >
                <td style="text-align:center; font-weight: bold; color: skyblue;" >
                    <a :href="'https://www.google.com/search?q=' + content.enWord + '&newwindow=1&source=lnms&tbm=isch&sa=X&ved=2ahUKEwjwgc7Lj83wAhXHFogKHYUABiYQ_AUoAXoECAEQAw&biw=1920&bih=937'" target="blank" > üëì</a >
                </td >
                <td style="text-align:center; font-weight: bold; color: skyblue;" >
                    <a :href="'https://www.google.com/search?q=' + content.enWord + '&rlz=1C1GCEA_koKR939KR939&oq=taglib&aqs=chrome..69i57j0l6j69i60.1267j0j4&sourceid=chrome&ie=UTF-8'" target="blank" > üìö</a >
                </td >
            </tr >
            </tbody >
        </table >
    </div >
    <!-- /board area -->

    <br />

    <!-- pagination area -->
    <div >
        <paging-component :pager="pager" :find-function="findContents" ></paging-component >
    </div >
    <!-- /pagination area -->

    <br /><br />

    <!-- footer area -->
    <div th:replace="fragments/footer :: footer" />
    <!-- /footer area -->

</div >
<!-- /container -->

</body >
<!-- /body -->

<!-- Vue.js paging component-->
<script th:src="@{/js/paging.js}" ></script >
<!-- /Vue.js paging component-->

<!-- Vue.js -->
<script >
    'use strict';
    const app = new Vue({
                            el        : '#app',
                            data      : {
                                search          : {
                                    page  : 0,
                                    size  : 10,
                                    enWord: '',
                                    krWord: ''
                                },
                                contents        : {},
                                pager           : {},
                                visitorsOfReduce: 0,
                                visitorsOfDay   : 0
                            },
                            components: {
                                'paging-component': pagingComponent,
                            },
                            mounted   : function(){
                                this.$nextTick(function(){
                                    this.findContents();
                                });
                            },
                            computed  : {
                                numberFormat(){
                                    return (num) => {
                                        let regexp = /\B(?=(\d{3})+(?!\d))/g;
                                        return num.toString().replace(regexp, ',');
                                    };
                                },
                            },
                            methods   : {
                                findContents(page){
                                    if(page !== undefined) this.search.page = page;
                                    let queryString = Object.keys(this.search)
                                                            .map(k => encodeURIComponent(k) + '=' + encodeURIComponent(this.search[k]))
                                                            .join('&');
                                    let uri = '/dictionaries?' + queryString;
                                    fetch(uri).then(res => {if(res.status === 200) return res.json()})
                                              .then(data => {
                                                  this.contents = data.pages.content;
                                                  this.visitorsOfReduce = data.visitorsOfReduce;
                                                  this.visitorsOfDay = data.visitorsOfDay;
                                                  this.pager = setPager(data.pages);

                                                  // ÌéòÏù¥Ïßï Î≤ÑÍ∑∏ Î∞©ÏßÄÏö© Î°úÏßÅ
                                                  if(this.search.page === 0 && this.pager.totalPages === 0) return;
                                                  if(this.search.page >= this.pager.totalPages){
                                                      this.search.page = 0;
                                                      this.findContents();
                                                  }
                                              })
                                              .catch(() => alert('400, Bad Request'));
                                },
                                resetSearchForm(){
                                    this.search.page = 0;
                                    this.search.size = 10;
                                    this.search.enWord = '';
                                    this.search.krWord = '';
                                    this.findContents();
                                },
                            },
                        });
</script >
<!-- /Vue.js -->
</html >